(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{188:function(e,t,a){"use strict";a.r(t);var r=a(0),n=Object(r.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"_3-vue-element前端导入导出excel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-vue-element前端导入导出excel","aria-hidden":"true"}},[e._v("#")]),e._v(" 3. Vue+Element前端导入导出Excel")]),e._v(" "),a("h2",{attrs:{id:"_1-前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-前言","aria-hidden":"true"}},[e._v("#")]),e._v(" 1 前言")]),e._v(" "),a("h3",{attrs:{id:"_1-1-业务场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-业务场景","aria-hidden":"true"}},[e._v("#")]),e._v(" 1.1 业务场景")]),e._v(" "),a("p",[e._v("由前台导入Excel表格，获取批量数据。")]),e._v(" "),a("p",[e._v("根据一个数组导出Excel表格。")]),e._v(" "),a("h2",{attrs:{id:"_2-实现原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-实现原理","aria-hidden":"true"}},[e._v("#")]),e._v(" 2 实现原理")]),e._v(" "),a("h3",{attrs:{id:"_2-1-引入工具库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-引入工具库","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.1 引入工具库")]),e._v(" "),a("blockquote",[a("p",[e._v("file-saver、xlsx、script-loader")])]),e._v(" "),a("p",[a("code",[e._v("npm install -S file-saver xlsx")])]),e._v(" "),a("p",[a("code",[e._v("npm install -D script-loader")])]),e._v(" "),a("h3",{attrs:{id:"_2-2-导入excel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-导入excel","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.2 导入Excel")]),e._v(" "),a("h4",{attrs:{id:"_2-2-1-element-上传控件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-element-上传控件","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.2.1 Element 上传控件")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://github.com/xrkffgg/Kimg/blob/master/blog/03-1.png?raw=true",alt:""}})]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('<el-upload\n    class="upload-demo"\n    action=""\n    :on-change="handleChange"\n    :on-exceed="handleExceed"\n    :on-remove="handleRemove"\n    :file-list="fileListUpload"\n    :limit="limitUpload"\n    accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel"\n    :auto-upload="false">\n    <el-button size="small" type="primary">点击上传</el-button>\n    <div slot="tip" class="el-upload__tip">只 能 上 传 xlsx / xls 文 件</div>\n</el-upload>\n')])])]),a("p",[a("code",[e._v("limitUpload = 1")]),e._v("限制只能上传1个文件")]),e._v(" "),a("p",[a("code",[e._v("accept")]),e._v("为默认打开的可上传的文件格式")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("handleChange(file, fileList){\n    this.fileTemp = file.raw\n},\n\nhandleRemove(file,fileList){\n    this.fileTemp = null\n},\n")])])]),a("p",[a("code",[e._v("fileTemp")]),e._v("这里定义了一下变量，指向最新上传的附件，起始定义为null。")]),e._v(" "),a("p",[e._v("这里发现控件"),a("code",[e._v("file.raw")]),e._v("是我们要用的"),a("code",[e._v("File")]),e._v("类型。")]),e._v(" "),a("h4",{attrs:{id:"_2-2-2-导入判断"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-导入判断","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.2.2 导入判断")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("if(this.fileTemp){\n    if((this.fileTemp.type == 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') || (this.fileTemp.type == 'application/vnd.ms-excel')){\n        this.importfxx(this.fileTemp)\n    } else {\n        this.$message({\n            type:'warning',\n            message:'附件格式错误，请删除后重新上传！'\n        })\n    }\n} else {\n    this.$message({\n        type:'warning',\n        message:'请上传附件！'\n    })\n}\n")])])]),a("h4",{attrs:{id:"_2-2-3-导入函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-导入函数","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.2.3 导入函数")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("importfxx(obj) {\n    let _this = this;\n    // 通过DOM取文件数据\n    this.file = obj\n    var rABS = false; //是否将文件读取为二进制字符串\n    var f = this.file;\n    var reader = new FileReader();\n    //if (!FileReader.prototype.readAsBinaryString) {\n    FileReader.prototype.readAsBinaryString = function(f) {\n        var binary = \"\";\n        var rABS = false; //是否将文件读取为二进制字符串\n        var pt = this;\n        var wb; //读取完成的数据\n        var outdata;\n        var reader = new FileReader();\n        reader.onload = function(e) {\n        var bytes = new Uint8Array(reader.result);\n        var length = bytes.byteLength;\n        for(var i = 0; i < length; i++) {\n            binary += String.fromCharCode(bytes[i]);\n        }\n        var XLSX = require('xlsx');\n        if(rABS) {\n            wb = XLSX.read(btoa(fixdata(binary)), { //手动转化\n                type: 'base64'\n            });\n        } else {\n            wb = XLSX.read(binary, {\n                type: 'binary'\n            });\n        }\n        outdata = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);//outdata就是你想要的东西\n            this.da = [...outdata]\n            let arr = []\n            this.da.map(v => {\n                let obj = {}\n                obj.code = v['设备ID']\n                obj.type = v['设备型号']\n                arr.push(obj)\n            })\n            return arr\n        }\n        reader.readAsArrayBuffer(f);\n    }\n    \n    if(rABS) {\n        reader.readAsArrayBuffer(f);\n    } else {\n        reader.readAsBinaryString(f);\n    }\n},\n")])])]),a("p",[a("code",[e._v("arr")]),e._v("就是我们要的结果，是一个数组。每一个值是个对象，包含了"),a("code",[e._v("code")]),e._v(" "),a("code",[e._v("type")]),e._v("两个属性。")]),e._v(" "),a("p",[e._v("excel中格式为横向 设备ID 和 设备型号。")]),e._v(" "),a("h3",{attrs:{id:"_2-3-导出excel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-导出excel","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.3 导出Excel")]),e._v(" "),a("h4",{attrs:{id:"_2-3-1-引入js文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-引入js文件","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.3.1 引入JS文件")]),e._v(" "),a("p",[e._v("可参考下载地址：- "),a("a",{attrs:{href:"https://github.com/xrkffgg/tools/tree/master/JS/Excel",target:"_blank",rel:"noopener noreferrer"}},[e._v("github"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("将其中的2个JS文件放入到自己的工程中。")]),e._v(" "),a("h4",{attrs:{id:"_2-3-2-修改js文件中地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-修改js文件中地址","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.3.2 修改JS文件中地址")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://github.com/xrkffgg/Kimg/blob/master/blog/03-2.png?raw=true",alt:""}}),e._v("\n打开"),a("code",[e._v("Export2Excel.js")]),e._v("，会出现如上图所示。由于本人将"),a("code",[e._v("Blob.js")]),e._v("和"),a("code",[e._v("Export2Excel.js")]),e._v("放到了同一级，这里引入是这样的。")]),e._v(" "),a("p",[e._v("这几个文件不支持import引入，所以需要"),a("code",[e._v("script-loader")]),e._v("来将他们挂载到全局环境下。")]),e._v(" "),a("h4",{attrs:{id:"_2-3-3-导出函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-导出函数","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.3.3 导出函数")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("getExcel(res) {\n    require.ensure([], () => {\n        const { export_json_to_excel } = require('../../introduce/Export2Excel.js')\n        const tHeader = ['姓名', '年龄']\n        const filterVal = ['name', 'age']\n        const list = res\n        const data = this.formatJson(filterVal, list)\n        export_json_to_excel(tHeader, data, '导出列表名称')\n    })\n},\n\nformatJson(filterVal, jsonData) {\n    return jsonData.map(v => filterVal.map(j => v[j]))\n},\n")])])]),a("p",[e._v("这里的引用请根据自己的层级关系和文件夹命名"),a("code",[e._v("require('../../introduce/Export2Excel.js')")])]),e._v(" "),a("p",[a("code",[e._v("res")]),e._v("为传入的数组，格式如："),a("code",[e._v("res =[{name:'小白',age:'18'},{name:'小黑',age:'16'}]")])]),e._v(" "),a("p",[a("code",[e._v("tHeader")]),e._v("为导出Excel表头名称，"),a("code",[e._v("导出列表名称")]),e._v("即为导出Excel名称")]),e._v(" "),a("p",[e._v("下载的Excel位置根据浏览器设置的下载位置而定")]),e._v(" "),a("h2",{attrs:{id:"_3-后记"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-后记","aria-hidden":"true"}},[e._v("#")]),e._v(" 3 后记")]),e._v(" "),a("p",[a("strong",[e._v("感谢支持。若不足之处，欢迎大家指出，共勉。")])]),e._v(" "),a("p",[a("strong",[e._v("如果觉得不错，记得 点赞 ，谢谢大家")]),e._v(" 😂")]),e._v(" "),a("blockquote",[a("p",[a("strong",[e._v("欢迎关注 我的：")]),e._v(" "),a("a",{attrs:{href:"https://github.com/xrkffgg/Tools",target:"_blank",rel:"noopener noreferrer"}},[e._v("【Github】"),a("OutboundLink")],1),a("a",{attrs:{href:"https://juejin.im/user/59c369496fb9a00a4843a3e2/posts",target:"_blank",rel:"noopener noreferrer"}},[e._v("【掘金】"),a("OutboundLink")],1),a("a",{attrs:{href:"https://www.jianshu.com/u/4ca4daac5890",target:"_blank",rel:"noopener noreferrer"}},[e._v("【简书】"),a("OutboundLink")],1),a("a",{attrs:{href:"https://blog.csdn.net/xrk_ffgg",target:"_blank",rel:"noopener noreferrer"}},[e._v("【CSDN】"),a("OutboundLink")],1),a("a",{attrs:{href:"https://my.oschina.net/xrkffgg",target:"_blank",rel:"noopener noreferrer"}},[e._v("【OSCHINA】"),a("OutboundLink")],1),a("a",{attrs:{href:"https://segmentfault.com/u/xrkffgg/articles",target:"_blank",rel:"noopener noreferrer"}},[e._v("【SF】"),a("OutboundLink")],1)])]),e._v(" "),a("h3",{attrs:{id:"_3-1-参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-参考资料","aria-hidden":"true"}},[e._v("#")]),e._v(" 3.1 参考资料")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/liguiwang/p/8430672.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("www.cnblogs.com/liguiwang.."),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/qiu-Ann/p/7743897.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("www.cnblogs.com/qiu..."),a("OutboundLink")],1)])])])},[],!1,null,null,null);t.default=n.exports}}]);